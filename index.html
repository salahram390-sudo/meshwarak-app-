<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ูุดูุงุฑู</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#070A10">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">๐</div>
        <div>
          <h1>ูุดูุงุฑู</h1>
          <p id="sub">ุงุฎุชูุฑ ููุน ุงูุงุณุชุฎุฏุงู</p>
        </div>
      </div>
      <button class="btn" id="authBtn">ุชุณุฌูู ุงูุฏุฎูู</button>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <h2 class="title">ุงุจุฏุฃ ุจุณุฑุนุฉ</h2>
      <div class="hint">
        ุงุฎุชุฑ <b>ุฑุงูุจ</b> ูุทูุจ ูุดูุงุฑุ ุฃู <b>ุณุงุฆู</b> ูุงุณุชูุจุงู ุงูุทูุจุงุช.
      </div>

      <div class="actions" style="margin-top:14px">
        <a class="btn success" href="passenger.html">๐ ุฑุงูุจ</a>
        <a class="btn primary" href="driver.html">๐งโโ๏ธ ุณุงุฆู</a>
      </div>

      <div class="pills" style="margin-top:12px">
        <span class="pill" id="statePill">ุฌุงุฑู ุงูุชุญููโฆ</span>
      </div>

      <div class="hr"></div>
      <div class="small">ูู ุงูุตูุญุฉ ูุง ุงุชุญุฏูุซุชุด ููุฑูุง: ุงุนูู Refresh ูุฑุฉ.</div>
    </div>
  </div>

  <script type="module">
    import { auth, doLogout, getUserDoc } from "./app.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    const authBtn = document.getElementById("authBtn");
    const statePill = document.getElementById("statePill");
    const sub = document.getElementById("sub");

    onAuthStateChanged(auth, async (user)=>{
      if(!user){
        authBtn.textContent = "ุชุณุฌูู ุงูุฏุฎูู";
        authBtn.onclick = ()=> location.href = "login.html";
        statePill.textContent = "ุบูุฑ ูุณุฌู ุฏุฎูู";
        statePill.className = "pill bad";
        sub.textContent = "ุงุฎุชูุฑ ููุน ุงูุงุณุชุฎุฏุงู";
        return;
      }

      const data = await getUserDoc(user.uid);
      authBtn.textContent = "ุชุณุฌูู ุฎุฑูุฌ";
      authBtn.onclick = doLogout;

      const role = data?.role || "ุบูุฑ ูุญุฏุฏ";
      statePill.textContent = `โ ูุณุฌู ุฏุฎูู (${role})`;
      statePill.className = "pill ok";
      sub.textContent = "ุฌุงูุฒ ููุงุณุชุฎุฏุงู";
    });

    if ("serviceWorker" in navigator) navigator.serviceWorker.register("./sw.js");
  </script>
</body>
</html>
