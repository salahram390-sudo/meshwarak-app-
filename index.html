<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>ูุดูุงุฑู</title>
  <link rel="stylesheet" href="./styles.css?v=9">
</head>

<body>
  <div class="container auth" style="padding-top:18px">
    <div class="card auth-card">
      <div class="auth-logo">
        <div class="logoBig">ู</div>
        <h1>ูุดูุงุฑู ๐</h1>
        <p class="hint">ุงุฎุชุฑ ููุน ุงูุงุณุชุฎุฏุงู</p>
      </div>

      <div class="grid2">
        <a class="btn primary" href="./login.html">ุชุณุฌูู / ุฅูุดุงุก ุญุณุงุจ</a>
        <a class="btn" href="./account.html">ุญุณุงุจู</a>
      </div>

      <div class="sep"></div>

      <div class="grid2">
        <a class="btn" href="./passenger.html">ุงูุฏุฎูู ูู ุฑุงูุจ</a>
        <a class="btn" href="./driver.html">ุงูุฏุฎูู ูู ุณุงุฆู</a>
      </div>

      <div class="sep"></div>

      <button class="btn" id="hardRefreshBtn" type="button">โฉ ุชุญุฏูุซ ููู (ุญู ุงููุดุงูู)</button>
      <div class="hint" id="swHint" style="margin-top:10px"></div>
    </div>
  </div>

  <script type="module">
    const swHint = document.getElementById("swHint");
    const hardRefreshBtn = document.getElementById("hardRefreshBtn");

    async function nukeSW(){
      try{
        if("serviceWorker" in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          for(const r of regs) await r.unregister();
        }
        if("caches" in window){
          const keys = await caches.keys();
          for(const k of keys) await caches.delete(k);
        }
        swHint.textContent = "โ ุชู ูุณุญ ุงููุงุด ู Service Worker.";
      }catch(e){
        swHint.textContent = "โ๏ธ ุชุนุฐุฑ ุงููุณุญ (ูุด ูุดููุฉ ูุจูุฑุฉ).";
      }
    }

    hardRefreshBtn.addEventListener("click", async ()=>{
      swHint.textContent = "ุฌุงุฑู ุงูุชูุธููโฆ";
      await nukeSW();
      // ุงุฌุจุงุฑ ุชุญููู ุฌุฏูุฏ
      location.href = "./index.html?v=" + Date.now();
    });

    // ุฑุณุงูุฉ ุณุฑูุนุฉ
    swHint.textContent = "ูู ุงูุตูุญุฉ ูุง ุงุชุญุฏุซุชุด ููุฑุงูุ ุฌุฑูุจ Refresh.";
  </script>
</body>
</html>
