<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1020" />
  <title>ูุดูุงุฑู - ุงูุฑุฆูุณูุฉ</title>
  <!-- ูุณุฑ ูุงุด ููู -->
  <link rel="stylesheet" href="./styles.css?v=20260212a">
  <style>
    /* ูููุน ุฃู โุตูุญุฉ ุจูุถุงโ ุญุชู ูู ุฑุฌุน ูู ูุงุด ูุฏูู */
    html,body{ background: var(--bg, #0b1020) !important; }
    .card::before, .card::after, .glow::before, .glow::after { pointer-events:none !important; }
  </style>
</head>

<body>
  <div class="container" style="padding-top:18px">
    <div class="card glow" style="max-width:520px;margin:0 auto;text-align:center">
      <div style="display:flex;flex-direction:column;align-items:center;gap:10px">
        <div class="logoBig">ู</div>
        <h1 style="margin:0">ูุดูุงุฑู ๐</h1>
        <div class="hint">ุงุฎุชุฑ ููุน ุงูุงุณุชุฎุฏุงู</div>
      </div>

      <div class="actions" style="margin-top:16px;flex-direction:column;gap:10px">
        <a class="btn primary" href="./login.html" id="goPassenger">ุฑุงูุจ ๐</a>
        <a class="btn" href="./login.html" id="goDriver">ุณุงุฆู ๐งโโ๏ธ</a>
      </div>

      <div class="sep" style="height:1px;background:var(--stroke);margin:14px 0"></div>

      <button class="btn" id="hardRefresh" type="button">โฉ ุชุญุฏูุซ ููู (ุญู ุงููุดุงูู)</button>
      <div class="hint" id="pwaInfo" style="margin-top:10px"></div>
    </div>
  </div>

  <script type="module">
    const goPassenger = document.getElementById("goPassenger");
    const goDriver = document.getElementById("goDriver");
    const hardRefresh = document.getElementById("hardRefresh");
    const pwaInfo = document.getElementById("pwaInfo");

    goPassenger.addEventListener("click", ()=>{
      localStorage.setItem("role","passenger");
    });
    goDriver.addEventListener("click", ()=>{
      localStorage.setItem("role","driver");
    });

    hardRefresh.addEventListener("click", async ()=>{
      try{
        // ููุณุญ ูุงุด ุงูู SW ุนุดุงู ูุง ูุฑุฌุนุด ุตูุญุฉ ุจูุถุง/ุณุชุงูู ูุฏูู
        if("serviceWorker" in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r => r.unregister()));
        }
        if("caches" in window){
          const keys = await caches.keys();
          await Promise.all(keys.map(k => caches.delete(k)));
        }
      }catch(e){}

      // Reload ููู
      location.reload(true);
    });

    // ูุนูููุฉ PWA ุจุณูุทุฉ
    const ok = ("serviceWorker" in navigator);
    pwaInfo.textContent = ok ? "โ ุงูุชุทุจูู ุฌุงูุฒ ูู PWA (SW ูุชุงุญ)." : "โ๏ธ ุฌูุงุฒู/ูุชุตูุญู ูุง ูุฏุนู Service Worker.";
  </script>
</body>
</html>
