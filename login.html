<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1020" />
  <title>Ù…Ø´ÙˆØ§Ø±Ùƒ - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
  <!-- ÙƒØ³Ø± ÙƒØ§Ø´ Ù‚ÙˆÙŠ -->
  <link rel="stylesheet" href="./styles.css?v=20260212a">
  <style>
    /* Ù…Ù‡Ù…: Ø£ÙŠ Ù„Ù…Ø¹Ø©/overlay Ù…Ø§ ØªÙ…Ø³ÙƒØ´ Ø§Ù„Ù„Ù…Ø³ */
    .card::before, .card::after, .glow::before, .glow::after { pointer-events:none !important; }
    .card, .container, .topbar, .btn, button, input, select, a { pointer-events:auto; }
    .seg, .actions { position:relative; z-index:3; }

    /* Segmented control (Ø±Ø§ÙƒØ¨/Ø³Ø§Ø¦Ù‚) */
    .seg{
      display:flex;
      gap:10px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      padding:10px;
      border-radius:18px;
      margin-top:12px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .seg-btn{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      height:52px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: #e9eefc;
      font-weight:700;
      cursor:pointer;
      touch-action: manipulation;
    }
    .seg-btn .ic{ font-size:20px; opacity:.95; }
    .seg-btn.active{
      background: linear-gradient(135deg, rgba(58,123,255,.35), rgba(138,58,255,.25));
      border-color: rgba(110,170,255,.45);
      box-shadow: 0 0 0 1px rgba(110,170,255,.15) inset, 0 12px 30px rgba(40,110,255,.18);
    }

    /* Ø¥Ø¸Ù‡Ø§Ø± driver fields: Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ Ø¸Ø§Ù‡Ø±ÙŠÙ† (Ù„Ùˆ JS Ø­ØµÙ„ Ù„Ù‡ Ù…Ø´ÙƒÙ„Ø©) */
    #driverFields { display:block; }
    body.role-passenger #driverFields { display:none; }
  </style>
</head>

<body class="role-passenger">
  <div class="container" style="padding-top:18px">
    <div class="card glow" style="max-width:520px;margin:0 auto">
      <div style="display:flex;flex-direction:column;align-items:center;text-align:center;gap:10px">
        <div class="logoBig">Ù…</div>
        <h1 style="margin:0">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h1>
        <div class="hint">Ø§Ø®ØªØ± ØªØ¯Ø®Ù„ ÙƒÙ€ Ø±Ø§ÙƒØ¨ Ø£Ùˆ Ø³Ø§Ø¦Ù‚ â€” Ù†ÙØ³ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙŠØ´ØªØºÙ„ ÙÙŠ Ø§Ù„Ø§Ø«Ù†ÙŠÙ† âœ…</div>
      </div>

      <div class="seg" role="tablist" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ±">
        <button type="button" class="seg-btn active" id="passBtn" aria-selected="true">
          <span class="ic">ğŸš•</span> Ø±Ø§ÙƒØ¨
        </button>
        <button type="button" class="seg-btn" id="drvBtn" aria-selected="false">
          <span class="ic">ğŸ§‘â€âœˆï¸</span> Ø³Ø§Ø¦Ù‚
        </button>
      </div>

      <div class="field">
        <label>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
        <input id="email" placeholder="example@gmail.com" inputmode="email" autocomplete="email" />
      </div>

      <div class="field">
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)</label>
        <input id="pass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
      </div>

      <div class="sep" style="height:1px;background:var(--stroke);margin:14px 0"></div>

      <div class="field">
        <label>Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="name" placeholder="Ø§Ø³Ù…Ùƒ" autocomplete="name" />
      </div>

      <div class="field">
        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ù‡Ù… Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©)</label>
        <input id="phone" placeholder="01xxxxxxxxx" inputmode="tel" autocomplete="tel" />
      </div>

      <!-- Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ -->
      <div id="driverFields">
        <div class="sep" style="height:1px;background:var(--stroke);margin:14px 0"></div>

        <div class="field">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ù„Ù„Ø³Ø§Ø¦Ù‚)</label>
          <select id="vehicle">
            <option value="car">Ø³ÙŠØ§Ø±Ø© Ù…Ù„Ø§ÙƒÙŠ</option>
            <option value="microbus">Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ</option>
            <option value="tuktuk">ØªÙˆÙƒØªÙˆÙƒ</option>
            <option value="tmanya">ØªÙ…Ù†Ø§ÙŠØ©</option>
            <option value="motor_delivery">Ù…ÙˆØªØ³ÙŠÙƒÙ„ Ø¯Ù„ÙŠÙØ±ÙŠ</option>
            <option value="caboot">Ø¹Ø±Ø¨ÙŠØ© ÙƒØ§Ø¨ÙˆØª</option>
          </select>
        </div>

        <div class="grid2">
          <div class="field" style="margin-top:0">
            <label>Ù…ÙˆØ¯ÙŠÙ„/Ø³Ù†Ø©</label>
            <input id="model" placeholder="Ù…Ø«Ø§Ù„: 2020 / BYD" />
          </div>
          <div class="field" style="margin-top:0">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="plate" placeholder="Ù…Ø«Ø§Ù„: Ø³ Ø¬ 1234" />
          </div>
        </div>

        <div class="hint">* Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ØªØ¸Ù‡Ø± Ù„Ù„Ø±Ø§ÙƒØ¨ Ø¹Ù†Ø¯ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø©.</div>
      </div>

      <div class="actions" style="margin-top:14px;flex-direction:column;gap:10px">
        <button class="btn primary" id="loginBtn" type="button">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
        <button class="btn" id="signupBtn" type="button">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        <a class="btn" href="./index.html">â†© Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      </div>

      <div class="hint" id="msg" style="margin-top:10px"></div>
    </div>
  </div>

  <script type="module">
    import { emailSignIn, emailSignUp, saveUserProfile } from "./app.js";

    const msg = document.getElementById("msg");

    const passBtn = document.getElementById("passBtn");
    const drvBtn  = document.getElementById("drvBtn");

    const emailEl = document.getElementById("email");
    const passEl  = document.getElementById("pass");
    const nameEl  = document.getElementById("name");
    const phoneEl = document.getElementById("phone");
    const vehicleEl = document.getElementById("vehicle");
    const modelEl   = document.getElementById("model");
    const plateEl   = document.getElementById("plate");

    function setRole(role){
      localStorage.setItem("role", role);
      document.body.classList.toggle("role-passenger", role !== "driver");

      passBtn.classList.toggle("active", role !== "driver");
      drvBtn.classList.toggle("active", role === "driver");

      passBtn.setAttribute("aria-selected", role !== "driver");
      drvBtn.setAttribute("aria-selected", role === "driver");
    }

    // Ø§ÙØªØ±Ø§Ø¶ÙŠ
    setRole(localStorage.getItem("role") || "passenger");

    passBtn.addEventListener("click", ()=> setRole("passenger"));
    drvBtn.addEventListener("click", ()=> setRole("driver"));

    function normalizePhone(p){
      const x = (p || "").trim();
      if(!x) return null;
      const cleaned = x.replace(/[^\d+]/g, "");
      return cleaned.length >= 8 ? cleaned : null;
    }

    async function afterAuth(user){
      const role = localStorage.getItem("role") === "driver" ? "driver" : "passenger";
      const payload = {
        name: nameEl.value.trim() || null,
        phone: normalizePhone(phoneEl.value),
        role,
      };

      if(role === "driver"){
        payload.vehicle = vehicleEl.value || null;
        payload.model = modelEl.value.trim() || null;
        payload.plate = plateEl.value.trim() || null;
      }else{
        payload.vehicle = null; payload.model = null; payload.plate = null;
      }

      await saveUserProfile(user.uid, payload);

      // ØªÙˆØ¬ÙŠÙ‡ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
      location.href = role === "driver" ? "./driver.html" : "./passenger.html";
    }

    document.getElementById("loginBtn").addEventListener("click", async ()=>{
      msg.textContent = "Ø¬Ø§Ø±Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„â€¦";
      try{
        const email = emailEl.value.trim();
        const pass  = passEl.value;
        const cred = await emailSignIn(email, pass);
        await afterAuth(cred.user);
      }catch(e){
        console.error(e);
        msg.textContent = "âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.";
      }
    });

    document.getElementById("signupBtn").addEventListener("click", async ()=>{
      msg.textContent = "Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨â€¦";
      try{
        const email = emailEl.value.trim();
        const pass  = passEl.value;

        if(pass.length < 6){
          msg.textContent = "âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø§Ø²Ù… 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.";
          return;
        }

        // Ù„Ùˆ ÙƒØªØ¨ Ø±Ù‚Ù… ÙˆÙ…Ø´ ØµØ§Ù„Ø­
        if(phoneEl.value.trim() && !normalizePhone(phoneEl.value)){
          msg.textContent = "âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­ (Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø£Ø·ÙˆÙ„).";
          return;
        }

        const cred = await emailSignUp(email, pass);
        await afterAuth(cred.user);
      }catch(e){
        console.error(e);
        msg.textContent = "âŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨. Ø±Ø¨Ù…Ø§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„.";
      }
    });
  </script>
</body>
</html>
